# 分かりやすい合意アルゴリズムを求めて

##概要

1. 紹介

ラフトはログの複製を管理するための合意アルゴリズムです。

	* 強いリーダー
	* リーダー選挙
	* メンバー変更

2. ステートマシンの複製

3. パクソスの何が悪いのか

4. 理解性のためのデザイン

5. ラフト合意アルゴリズム

ラフトは2章で示した形の複製ログを管理するためのアルゴリズムです。図2は、参考用にアルゴリズムを凝縮してまとめたもので、図3はアルゴリズムの重要な特性の一覧です。これらの図の要素については、このセクションの残りの部分では個別に説明します。

ラフトは最初に特別な *リーダー* を選出し、複製ログの管理に対する完全な責任を与えることで合意を行います。

リーダーはクライアントからのログエントリを受け付け、それを他のサーバー群に複製し、サーバ群の各々が持つステートマシンにログエントリを適用することが安全になったら サーバ群へ通知を行います。リーダーを持つことは複製ログの管理を単純化します。例えば、リーダーは他のサーバ群と相談せずに ログのどこに新しいエントリを置くかを決定でき、データはリーダーから他のサーバ群へ単純な方法で受け渡されます。 リーダーは障害が起こったり、他のサーバ群から切断されることがありますが、そのときは新たなリーダーが選ばれます。

リーダーアプローチによってラフトは合意問題を後の節で説明する3つの比較的独立した部分問題に分解します。

  * リーダー選挙 : 新たなリーダは既存のリーダが障害となったときに選ばれる必要があります。(5.2章)

  * ログ複製 : リーダーはクライアントからログエントリーを受け付け、それをクラスタ全体に複製し、自身と他のログとを強制的に一致させる必要があります。(5.3章)

  * 安全性 : 

--------
# 状態

## 全サーバーの永続的状態 :
(RPCに応答する前に安定したストレージ上で更新される)

currentTerm	サーバーが見る 最新の期間 (最初の起動時に 0 で初期化され、単調増加する)

votedFor	現在の期間で投票を受信した候補者ID (誰もいなければ null)

log[]   	ログエントリー。各エントリーはステートマシンに対するコマンドを含んでおり、リーダーによってエントリーが受信されたら終了する (最初のインデックスは 1)


## 全サーバの揮発的状態 :
commitIndex	コミットされたログエントリーのインデックスの最大値 (0で初期化され、単調増加する)

lastApplied	ステートマシンに適用されたログエントリーの最大のインデックス (0で初期化され、単調増加する)


## リーダーの揮発的状態 :
(選挙後に再初期化される)

nextIndex[]	各サーバーに送信される次のログエントリーのインデックス (リーダーの最新のログインデックス +1 に初期化される)

matchIndex[]	各サーバーが複製されたと認識するログエントリーの最大のインデックス (0で初期化され、単調増加する)


--------
# エントリー追加 RPC
ログエントリーを複製するためにリーダーが実行する(5.3節) またハートビートにも使用される。

## 引数 :
term    	リーダーの期間(任期)

leaderId	そのフォロワーはクライアントをリダイレクトすることができる。

--------

5.1 ラフトの基本

5.2 リーダー選挙

5.3 ログ複製

5.4 安全性

5.4.1 選挙制約

5.4.2 前期間のエントリをコミットする

5.4.3 安全性引数

5.5 フォロワーと候補者のクラッシュ

5.6 タイミングと可用性

6 クラスタメンバーシップの変更

7 ログの圧縮

8 クライアントとの対話

9 実装と評価

9.1 理解性

9.2 正確性

9.3 性能

10 関連する研究

11 結論

12 謝辞

## 参照
