## 状態遷移テストの設計にまつわる計算量問題 - クラスタ状態遷移テストの設計は NP完全問題

状態遷移テストは「ある状態」から「別の状態」へ何らかの操作・イベントなどで遷移することを数珠繋ぎにすることでデザインされる。
テスト中に通過する「状態」はそのシステムを構成する部分の各々の 正常・異常 などの 状態 を重ね合わせたものとなる。

あるシステムがとりうる状態の総数は以下の様に表される。

	(状態の総数) = (正常・異常の 2パタン) ^ (システムを構成する部分の数)

状態遷移テストの設計を「初期状態からテスト対象となる全ての状態を一回づつ経由して初期状態に戻る最も効率的なやり方を求める問題」と捉えると、
TSP(巡回セールスマン問題)相当となり、NP困難なクラスの問題であることが判る。

「構成部分が増えればテストの妥当性の検証が困難になること」は直観的なものであるが、これがNP完全な問題であるか否かには、まだ疑問が残る。
TSPに対して、各状態間に "状態Aから状態Bへの有向性" を付加するとハミルトン閉路問題となり、NP完全な問題として捉えられる。

	Traveling Salesman Problem (a.k.a. TSP) = NP Hard  
	               Hamiltonian Path Problem = NP Complete

例: CLUSTERPROの状態遷移テスト

NP解決 (*) をテストするとき、下記 状態遷移は不可逆であり、状態遷移は有向グラフとして捉えられる。すると クラスタの状態遷移探索問題はハミルトン閉路問題に帰着可能となり、NP完全問題として捉えられる。

(*) HAクラスタにおける NP は Network Parition (ネットワーク分断) を意味する。先に挙げたNP完全・NP困難における NP は Non-deterministic Polynomial time (非決定性多項式時間) を意味する。

	+----------- Node1の稼働状態
	|+---------- FOGの稼働状態
	||  +------- 系間NWの疎通状態
	||  |  +---- Node2の稼働状態
	||  |  |+--- FOGの稼働状態
	||  |  ||
	oA --- o
	oA -x- o   NP発生
	oA -x- oA  両系活性が発生
	oA --- oA  両系活性を認識
	oA --- x   両系活性を性認したため自殺 ( x  --- oA もありうる)  
	x  --- x   両系活性を認識したため自殺

多項式時間で検証可能な(閉路となる)状態遷移グラフを得る計算量は、ノード数の増加など「想定する故障個所の増加」に伴って爆発的に増えるが、それでも「最も効率的な経路を探索すること」及び「発見された経路の検証」は多項式時間で可能。
